
networks:
  acnetwork:
    driver: bridge
  proxy:
    external: true

volumes:
  static_volume:
  staticfiles_volume:
  media_volume:
  logs_volume:

services:
  afriqconsultingweb:
    build:
      context: .
      dockerfile: Dockerfile
    command: >
      gunicorn afriqconsulting.wsgi:application
      --bind 0.0.0.0:8000
      --workers 2
      --threads 2
      --timeout 60
      --log-level warning
      --access-logfile /afriqconsulting/logs/gunicorn.access.log
      --error-logfile /afriqconsulting/logs/gunicorn.error.log
    env_file: [.env]
    volumes:
      - .:/afriqconsulting
      - static_volume:/afriqconsulting/static
      - staticfiles_volume:/afriqconsulting/staticfiles
      - media_volume:/afriqconsulting/media
      - logs_volume:/afriqconsulting/logs
      - ./db.sqlite3:/afriqconsulting/db.sqlite3
    restart: unless-stopped
    networks: [acnetwork, proxy]

    labels:
      - traefik.enable=true
      - traefik.docker.network=proxy

      # Router HTTPS apex
      - traefik.http.routers.afriq.rule=Host(`afriqconsulting.com`)
      - traefik.http.routers.afriq.entrypoints=websecure
      - traefik.http.routers.afriq.tls.certresolver=lets
      - traefik.http.routers.afriq.service=afriq
      - traefik.http.routers.afriq.middlewares=sec-headers@docker,compress@docker,ratelimit@docker

      # Service â†’ port interne
      - traefik.http.services.afriq.loadbalancer.server.port=8000